
<!DOCTYPE html>
<html lang="en">
<head>
	<title>Beer Crossfilter</title>

    <meta charset="UTF-8">

    <script type="text/javascript" src="js/crossfilter.v1.min.js"></script>
    <script type="text/javascript" src="js/d3.v2.min.js"></script>
    <script type="text/javascript" src="js/dc.min.js"></script>

    <link href="css/bootstrap.min.css"   rel="stylesheet">
    <link href="css/beercrossfilter.css" rel="stylesheet">
</head>
<body>


<div id="body">

<h1>Beer Crossfilter</h1>

<br/>

<div id="charts">
  <div id="og-chart" class="dc-chart">
    <div class="title">Original Gravity</div>
    <a class="reset" href="javascript:ogChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>
  </div>
  <br/>
  <div id="abv-chart" class="dc-chart">
    <div class="title">Alcohol by Volume</div>
    <a class="reset" href="javascript:abvChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>
  </div>
  <br/>
  <div id="ibu-chart" class="dc-chart">
    <div class="title">International Bitterness Units</div>
    <a class="reset" href="javascript:ibuChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>
  </div>
  <br/>
  <div id="srm-chart" class="dc-chart">
    <div class="title">SRM</div>
    <a class="reset" href="javascript:srmChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>
  </div>
  <br/>
  <div id="style-chart" class="dc-chart">
    <div class="title">Style</div>
    <a class="reset" href="javascript:styleChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>
  </div>
</div>
<br/>
<div class="row">
    <div >
        <div class="data-count">
            <span class="filter-count"></span> selected out of <span class="total-count"></span> records | <a href="javascript:dc.filterAll(); dc.renderAll();">Reset All</a>
        </div>
    </div>
    <br/>
    <table class="table table-hover data-table">
        <thead>
        <tr class="header">
            <th>Style</th>
            <th>OG</th>
            <th>ABV</th>
            <th>IBU</th>
            <th>SRM</th>
        </tr>
        </thead>
    </table>
</div>

<footer>
  Copyright 2012 <a href="https://github.com/mjaskula">Matthew Jaskula</a>
</footer>

</div>

<a href="https://github.com/mjaskula/beercrossfilter"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

<script  type="text/javascript">

var ogChart  = dc.barChart("#og-chart");
var abvChart = dc.barChart("#abv-chart");
// var ibuChart = dc.barChart("#ibu-chart");
// var srmChart = dc.barChart("#srm-chart");

d3.json("beers.json", function(data) {

	data.forEach(function(b) { 
		b.og = parseFloat(b.og).toPrecision(4);
		if (b.og > 2) {
			b.og = 1.050 // TODO: convert from plato?
		}
	});

	// feed it through crossfilter
	var beercrossfilter = crossfilter(data);
	 
	// define group all for counting
	var all = beercrossfilter.groupAll();
	 
	// define dimensions
	var ogDimension      = beercrossfilter.dimension(function(d) { return d.og; });
	var abvDimension     = beercrossfilter.dimension(function(d) { return d.abv; });
	var ibuDimension     = beercrossfilter.dimension(function(d) { return d.ibu; });
	var srmDimension     = beercrossfilter.dimension(function(d) { return d.srm; });
	var styleIdDimension = beercrossfilter.dimension(function(d) { return d.styleId; });

	// map/reduce to group sum
	var ogGroup      = ogDimension.group();
	var abvGroup     = abvDimension.group();
	var ibuGroup     = ibuDimension.group();
	var srmGroup     = srmDimension.group();
	var styleIdGroup = styleIdDimension.group();

  ogChart
    .dimension(ogDimension)
    .group(ogGroup)
    .width(1000)
    .height(250)
    .margins({top: 10, right: 50, bottom: 30, left: 40})
    .transitionDuration(250)
    .gap(1)
    .x(d3.scale.linear().domain([0.995, 1.15]))
    .xUnits(dc.units.float.precision(0.001))
    .renderHorizontalGridLines(true)
    .renderVerticalGridLines(true);

  abvChart
    .dimension(abvDimension)
    .group(abvGroup)
    .width(1000)
    .height(250)
    .margins({top: 10, right: 50, bottom: 30, left: 40})
    .transitionDuration(250)
    .gap(1)
    .x(d3.scale.linear().domain([0, 12]))
    .xUnits(dc.units.float.precision(0.1))
    .renderHorizontalGridLines(true)
    .renderVerticalGridLines(true)
    .xAxis()
    .tickFormat(function(v) {
        return v + "%";
    });

	dc.dataCount(".data-count")
	    .dimension(beercrossfilter) // set dimension to all data
	    .group(all); // set group to ndx.groupAll()

	dc.dataTable(".data-table")
	    // set dimension
	    .dimension(styleIdDimension)
	    // data table does not use crossfilter group but rather a closure
	    // as a grouping function
	    .group(function(d) {
	        return d.styleId;
	    })
	    // (optional) max number of records to be shown, :default = 25
	    .size(200)
	    // dynamic columns creation using an array of closures
	    .columns([
	        function(d) { return d.style; },
	        function(d) { return d.og; },
	        function(d) { return d.abv; },
	        function(d) { return d.ibu; },
	        function(d) { return d.srm; }
	    ])
	    // (optional) sort using the given field, :default = function(d){return d;}
	    .sortBy(function(d){ return d.style; })
	    // (optional) sort order, :default ascending
	    .order(d3.ascending);

    // simply call renderAll() to render all charts on the page
	dc.renderAll();
	 
});
</script>
</body>
</html>
